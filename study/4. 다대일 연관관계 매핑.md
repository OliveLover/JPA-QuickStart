<h1>4. 다대일 연관관계 매핑</h1>

<h3>1. 연관관계 매핑 기준</h3>

|기준|설명|
|:---:|:---:|
|방향성<br />(Direction)|방향성은 단방향 관계와 양방향 관계가 있습니다.<br /> 예를 들어 직원(Employee)객체가 참조 변수를 통해 부서(Department) 객체를 참조하면 단반향입니다.<br />하지만 반대로 부서 객체도 참조 변수를 통해 직원 객체를 참조한다면 양방향이 됩니다. <br />중요한 것은 방향은 객체에만 존재하고 테이블은 항상 양방향이라는 것입니다.|
|다중성<br />(Multiplicity)|다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:N)관계가 있습니다.<br />예를 들어 여러 직원이 하나의 부서에 속해 있다면 직원과 부서의 관계는 다대일 관계입니다.<br />하지만 반대로 부서 입장에서 보면 일대다 관계가 됩니다.<br />그런데 직원이 여러 부서에 소속될 수 있다고 가정하면 다대다 관계로 바뀌게 됩니다.<br />이렇게 다중성은 비즈니스에 따라서 변경될 수 있습니다.|

<h3>2. 다대일 단방향 매핑</h3>

<h4>가정</h4>

```
직원(Employee)과 부서(Dempartment)가 있습니다.
직원 여러 명은 하나의 부서에 소속됩니다.
직원과 부서는 다대일(N : 1) 관계입니다.
직원을 조회했을 때, 직원이 속해 있는 부서 정보도 같이 조회됩니다.
반대로 부서를 통해서 직원 정보에 접근할 수 없습니다.
```
<h4>ERD Diagram</h4>
<img width="604" alt="image" src="https://github.com/OliveLover/JPA-QuickStart/assets/118647313/07883519-8dc9-4627-b938-dd0eb613fdcd">

```
import lombok.Data;

import javax.persistence.*;

@Data
@Entity
@Table(name = "S_DEPT")
public class Department {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long deptId;

    @Column(length = 25, nullable = false)
    private String name;
}
```

```
import lombok.Data;

import javax.persistence.*;

@Data
@Entity
@Table(name = "S_EMP")
public class Employee {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(length = 25, nullable = false)
    private String name;

    @ManyToOne
    @JoinColumn(name = "DEPT_ID")
    private Department dept;
}
```

<p><code>부서 테이블(S_DEPT)</code>과 매핑되는 <code>부서 객체</code>는 <code>직원(Employee) 객체</code>로 부터 참조 당하는 입장이기 때문에 연관관계 매핑과 관련해서 특별히 추가할 설정은 없습니다. </p>

<p><code>직원(Employee)</code> 클래스에서 가장 중요한 것은 <code>부서(Department)</code> 엔티티를 참조하는 <code>dept</code> 참조 변수 입니다. <code>@ManyToOne</code>은 <code>다(Many)</code>에 해당하는 엔티티가 <code>일(One)</code>에 해당하는 엔티티를 참조할 때 <code>다(Many)</code>에 해당하는 엔티티에 설정해야 합니다. </p>

<p><code>@JoinColumn</code>은 조인에 사용할 외래 키 칼럼을 매핑할 때 사용합니다. 위 설정대로라면 현재 <code>Employee</code>엔티티와 매핑된 <code>S_EMP</code>테이블에 <code>DEPT_ID</code> 칼럼을 외래 키로 설정한다는 의미입니다.</p>

<h4>@JoinColumn 생략 시 JPA 자동 네이밍 규칙</h4>

```
참조변수 이름 + '_' + 참조하는 테이블의 주 키 칼럼 이름
```

```
Hibernate:
  create table S_EMP (
    id bigint generated by default as identity,
    name varchar(25) not null,
    dept_DEPT_ID bigint,
    primary key (id)
  )
```

<h4>@ManyToOne 어노테이션이 지원하는 속성</h4>

|속성|기능|기본 값|
|:---:|:---|:---|
|optional|연관된 엔티티가 반드시 있어야 하는지 여부를 결정<br />false로 설정하면 항상 있어야 한다는 의미|true|
|fetch|글로벌 패치 전략을 설정<br />EAGER는 연관 엔티티를 동시에 조회하며, LAZY는 연관 엔티티를 실제 사용할 때 조회|@MantyToOne:EAGER<br />@OneToMany:LAZY|
|cascade|영속성 전이 기능을 설정<br />연관 엔티티를 같이 저장하거나 삭제할 때 사용||
